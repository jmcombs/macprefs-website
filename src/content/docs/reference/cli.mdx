---
title: CLI Reference
description: Complete command-line interface reference for macprefs
---

import { Tabs, TabItem, Badge, Aside } from '@astrojs/starlight/components';

Complete documentation for all macprefs commands and flags.

## Commands

### `preflight`

Checks write access to user Preferences, runs a safe `defaults` write/delete smoke test, and warns if MDM profiles are present. No permanent changes are made.

```bash
macprefs preflight [--config <config>]
```

| Flag | Description | Tier |
|------|-------------|------|
| `-c,` | --config <config>   Path to config JSON (optional, validates if provided) | Free |
| `--version` | Show the version. | Free |
| `-h,` | --help              Show help information. | Free |

**Exit codes:**
- **pro:** `0` = PASS; `1` = FAIL; `2` = ISSUES FOUND
- **free:** `0` = PASS/ISSUES; `1` = generic failure

---

### `list`

Lists all preference domains, or keys within a specific domain.

```bash
macprefs list [--domain <domain>] [--format <format>]
```

| Flag | Description | Tier |
|------|-------------|------|
| `--domain <domain>` | Show keys within this domain instead of listing domains | Free |
| `--format <format>` | Output format (table|json) - json requires Pro tier (default: table) | Pro+ |
| `--version` | Show the version. | Free |
| `-h,` | --help              Show help information. | Free |

---

### `inspect`

Shows current values for preferences. Domain scope determined by license tier.

```bash
macprefs inspect [--domains <domains>] [--keys <keys>] [--format <format>]
```

| Flag | Description | Tier |
|------|-------------|------|
| `--domains <domains>` | Comma-separated domains to inspect | Free |
| `--keys <keys>` | Comma-separated keys to filter | Free |
| `--format <format>` | Output format (table|json) - json requires Pro tier (default: table) | Pro+ |
| `--version` | Show the version. | Free |
| `-h,` | --help              Show help information. | Free |

---

### `export`

Exports macOS preferences to a JSON configuration file.

```bash
macprefs export <output-file> [--domains <domains>] [--baseline] [--no-progress]
```

| Flag | Description | Tier |
|------|-------------|------|
| `--domains <domains>` | Comma-separated domains to include (overrides tier-based scope) | Free |
| `--baseline` | Compare against baseline (Pro only, v1.1) | Pro+ |
| `--no-progress` | Suppress progress output (for CI/scripting) | Free |
| `--version` | Show the version. | Free |
| `-h,` | --help              Show help information. | Free |

---

### `validate`

Checks that a config file is valid JSON with correct structure.

```bash
macprefs validate [--config <config>] [--format <format>]
```

| Flag | Description | Tier |
|------|-------------|------|
| `-c,` | --config <config>   Path to config JSON | Free |
| `--format <format>` | Output format (table|json) - json requires Pro tier (default: table) | Pro+ |
| `--version` | Show the version. | Free |
| `-h,` | --help              Show help information. | Free |

---

### `plan`

Shows what changes would be made without applying them. Read-only operation.

```bash
macprefs plan [--config <config>] [--format <format>] [--verbose] [--filter <filter>]
```

| Flag | Description | Tier |
|------|-------------|------|
| `-c,` | --config <config>   Path to config JSON | Free |
| `--format <format>` | Output format (table|json) - json requires Pro tier (default: table) | Pro+ |
| `-v,` | --verbose           Show all changes in detail | Free |
| `--filter <filter>` | Filter changes: conflicts, additions, all (Pro required) | Pro+ |
| `--version` | Show the version. | Free |
| `-h,` | --help              Show help information. | Free |

**Exit codes:**
- **pro:** `0` = no drift; `1` = error; `2` = drift detected
- **free:** `0` = command completed; `1` = generic failure

---

### `apply`

Applies config changes. Creates snapshot before any changes.

```bash
macprefs apply [--config <config>] [--yes] [--rollback-on-fail] [--no-rollback-on-fail] [--verbose]
```

| Flag | Description | Tier |
|------|-------------|------|
| `-c,` | --config <config>   Path to config JSON | Free |
| `--yes` | Auto-confirm apply (Pro tier, for CI/CD) | Pro+ |
| `--rollback-on-fail/--no-rollback-on-fail` |  Rollback on failure (default: --rollback-on-fail) | Free |
| `--verbose` | Verbose output | Free |
| `--version` | Show the version. | Free |
| `-h,` | --help              Show help information. | Free |

**Exit codes:**
- **pro:** `0` = success; `1` = failure
- **free:** `0` = success; `1` = failure

---

### `rollback`

Restores preferences to their state before an apply operation.

```bash
macprefs rollback [--run-id <run-id>]
```

| Flag | Description | Tier |
|------|-------------|------|
| `--run-id <run-id>` | Specific run ID to rollback (default: most recent) | Pro+ |
| `--version` | Show the version. | Free |
| `-h,` | --help              Show help information. | Free |

---

### `license`

Manage license activation and status.

```bash
macprefs license <subcommand>
```

| Flag | Description | Tier |
|------|-------------|------|
| `--version` | Show the version. | Free |
| `-h,` | --help              Show help information. | Free |

---

### `upgrade`

Opens the macprefs store to purchase or manage your license.

```bash
macprefs upgrade
```

| Flag | Description | Tier |
|------|-------------|------|
| `--version` | Show the version. | Free |
| `-h,` | --help              Show help information. | Free |

---

### `about`

Show version, license, and system information.

```bash
macprefs about
```

| Flag | Description | Tier |
|------|-------------|------|
| `--version` | Show the version. | Free |
| `-h,` | --help              Show help information. | Free |

---

### `license status`

Show current license tier and features

```bash
macprefs license status
```

| Flag | Description | Tier |
|------|-------------|------|
| `--version` | Show the version. | Free |
| `-h,` | --help              Show help information. | Free |

---

### `license activate`

Activate a license key on this device

```bash
macprefs license activate [--key <key>]
```

| Flag | Description | Tier |
|------|-------------|------|
| `--key <key>` | License key (prompts interactively if omitted) | Free |
| `--version` | Show the version. | Free |
| `-h,` | --help              Show help information. | Free |

---

### `license deactivate`

Deactivate the license on this device

```bash
macprefs license deactivate [--yes]
```

| Flag | Description | Tier |
|------|-------------|------|
| `-y,` | --yes               Skip confirmation prompt | Free |
| `--version` | Show the version. | Free |
| `-h,` | --help              Show help information. | Free |

---

## Tier Feature Comparison

| Feature | Free | Pro+ |
|---------|:----:|:----:|
| Apple domains (com.apple.*, NSGlobalDomain) | ✓ | ✓ |
| JSON export format | ✗ | ✓ |
| Third-party app domains | ✗ | ✓ |
| Headless mode (--yes) | ✗ | ✓ |
| --filter flag (plan) | ✗ | ✓ |
| Semantic exit codes (2 for drift) | ✗ | ✓ |
| --run-id (rollback to specific run) | ✗ | ✓ |
| --baseline (export) | ✗ | ✓ |

<Aside type="caution">
When a gated feature is used without proper license, the CLI returns exit code 1 with message:
`This feature requires Pro tier or higher. Run 'macprefs upgrade' to unlock.`
</Aside>

---

*Documentation auto-synced from macprefs CLI help.*
